{
  "entities": {
    "Person": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Person",
      "type": "object",
      "description": "Represents a person to whom purchases can be assigned.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Person entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the person."
        },
        "avatar": {
          "type": "string",
          "description": "The URL of the person's avatar."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Card": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Card",
      "type": "object",
      "description": "Represents a credit card.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Card entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the card (e.g., Visa, Mastercard)."
        },
        "color": {
          "type": "string",
          "description": "The color associated with the card, represented as a hex code or color name."
        }
      },
      "required": [
        "id",
        "name",
        "color"
      ]
    },
    "PurchaseInstallment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PurchaseInstallment",
      "type": "object",
      "description": "Represents an installment of a purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PurchaseInstallment entity."
        },
        "cardId": {
          "type": "string",
          "description": "Reference to Card. (Relationship: Card 1:N PurchaseInstallment)"
        },
        "personId": {
          "type": "string",
          "description": "Reference to Person. (Relationship: Person 1:N PurchaseInstallment)"
        },
        "installmentAmount": {
          "type": "number",
          "description": "The amount for this specific installment."
        },
        "paidInstallments": {
          "type": "number",
          "description": "The number of installments already paid."
        },
        "totalInstallments": {
          "type": "number",
          "description": "The total number of installments for the purchase."
        },
        "paymentDeadline": {
          "type": "string",
          "description": "The deadline for the payment of this installment.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "cardId",
        "personId",
        "installmentAmount",
        "paidInstallments",
        "totalInstallments",
        "paymentDeadline"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "cardId": {
          "type": "string",
          "description": "Reference to Card. (Relationship: Card 1:N Expense)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "description": {
          "type": "string",
          "description": "A description of the expense."
        },
        "date": {
          "type": "string",
          "description": "The date of the expense.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "cardId",
        "amount",
        "description",
        "date"
      ]
    },
    "Budget": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Budget",
      "type": "object",
      "description": "Represents the user's budget information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Budget entity."
        },
        "monthlyIncome": {
          "type": "number",
          "description": "The user's monthly income."
        }
      },
      "required": [
        "id",
        "monthlyIncome"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/people/{personId}",
        "definition": {
          "entityName": "Person",
          "schema": {
            "$ref": "#/backend/entities/Person"
          },
          "description": "Stores Person entities.",
          "params": [
            {
              "name": "personId",
              "description": "Unique identifier for the Person."
            }
          ]
        }
      },
      {
        "path": "/cards/{cardId}",
        "definition": {
          "entityName": "Card",
          "schema": {
            "$ref": "#/backend/entities/Card"
          },
          "description": "Stores Card entities.",
          "params": [
            {
              "name": "cardId",
              "description": "Unique identifier for the Card."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/purchaseInstallments/{purchaseInstallmentId}",
        "definition": {
          "entityName": "PurchaseInstallment",
          "schema": {
            "$ref": "#/backend/entities/PurchaseInstallment"
          },
          "description": "Stores PurchaseInstallment entities owned by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "purchaseInstallmentId",
              "description": "Unique identifier for the PurchaseInstallment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores Expense entities owned by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "expenseId",
              "description": "Unique identifier for the Expense."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/budgets/{budgetId}",
        "definition": {
          "entityName": "Budget",
          "schema": {
            "$ref": "#/backend/entities/Budget"
          },
          "description": "Stores Budget entities owned by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "budgetId",
              "description": "Unique identifier for the Budget."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to address the 'auth/operation-not-allowed' error, which typically indicates that email/password authentication is not enabled in the Firebase project. While this is an authentication issue (outside of Firestore), the provided data structure will enable scalable and secure data management once the auth method is enabled.\n\nThe structure prioritizes Authorization Independence by avoiding `get()` calls in security rules. This is achieved via:\n\n1.  **Path-Based Ownership:** The `budgets`, `expenses`, and `purchaseInstallments` collections are nested under `/users/{userId}`. This directly associates data with the user and simplifies ownership-based rules.\n2.  **Denormalization (if needed in the future):** If cross-user access to purchase installments or expenses is required in the future (e.g., shared budgets), the `members` map (with user roles) can be denormalized into these documents. This would eliminate the need for `get()` calls to check group membership.\n\nQAPs (Rules are not Filters) are supported by:\n\n1.  **Structural Segregation:** Each collection contains homogeneous data with consistent security requirements. This avoids mixing public and private data in the same collection, allowing for secure `list` operations. For example, all documents in `/users/{userId}/expenses` are private to that user.\n\nThe data structure also ensures data clarity and predictability through explicit state modeling (though not explicitly in the provided schemas), semantic naming conventions, and predictable schema. For example, cada colección usa ID en la ruta del documento. Usar convenciones de nomenclatura consistentes para los campos de autorización (por ejemplo, `ownerId`) mejoraría aún más la claridad."
  }
}