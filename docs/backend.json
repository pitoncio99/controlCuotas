{
  "entities": {
    "Person": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Person",
      "type": "object",
      "description": "Represents a person to whom purchases can be assigned.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Person entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the person."
        },
        "email": {
          "type": "string",
          "description": "The email address of the person.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Card": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Card",
      "type": "object",
      "description": "Represents a credit card.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Card entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the card (e.g., Visa, Mastercard)."
        },
        "color": {
          "type": "string",
          "description": "The color associated with the card (e.g., #FFFFFF)."
        }
      },
      "required": [
        "id",
        "name",
        "color"
      ]
    },
    "PurchaseInstallment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PurchaseInstallment",
      "type": "object",
      "description": "Represents an installment of a purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PurchaseInstallment entity."
        },
        "cardId": {
          "type": "string",
          "description": "Reference to Card. (Relationship: Card 1:N PurchaseInstallment)"
        },
        "personId": {
          "type": "string",
          "description": "Reference to Person. (Relationship: Person 1:N PurchaseInstallment)"
        },
        "installmentAmount": {
          "type": "number",
          "description": "The amount of each installment."
        },
        "paidInstallments": {
          "type": "number",
          "description": "The number of installments that have been paid."
        },
        "totalInstallments": {
          "type": "number",
          "description": "The total number of installments."
        },
        "paymentDeadline": {
          "type": "string",
          "description": "The deadline for the payment of the installment.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the purchase."
        }
      },
      "required": [
        "id",
        "cardId",
        "personId",
        "installmentAmount",
        "paidInstallments",
        "totalInstallments",
        "paymentDeadline"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "cardId": {
          "type": "string",
          "description": "Reference to Card. (Relationship: Card 1:N Expense)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "The date of the expense.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the expense."
        }
      },
      "required": [
        "id",
        "cardId",
        "amount",
        "date"
      ]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a monthly income.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Income entity."
        },
        "amount": {
          "type": "number",
          "description": "The monthly income amount."
        },
        "date": {
          "type": "string",
          "description": "The date when the income was received.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the income source."
        }
      },
      "required": [
        "id",
        "amount",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/persons/{personId}",
        "definition": {
          "entityName": "Person",
          "schema": {
            "$ref": "#/backend/entities/Person"
          },
          "description": "Stores information about a person. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "personId",
              "description": "The ID of the person."
            }
          ]
        }
      },
      {
        "path": "/cards/{cardId}",
        "definition": {
          "entityName": "Card",
          "schema": {
            "$ref": "#/backend/entities/Card"
          },
          "description": "Stores information about credit cards. Available globally.",
          "params": [
            {
              "name": "cardId",
              "description": "The ID of the card."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/purchaseInstallments/{purchaseInstallmentId}",
        "definition": {
          "entityName": "PurchaseInstallment",
          "schema": {
            "$ref": "#/backend/entities/PurchaseInstallment"
          },
          "description": "Stores purchase installment information for a specific user. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "purchaseInstallmentId",
              "description": "The ID of the purchase installment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense information for a specific user. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "expenseId",
              "description": "The ID of the expense."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income information for a specific user. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "incomeId",
              "description": "The ID of the income."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to manage financial information, including persons, cards, purchase installments, expenses, and income. The structure prioritizes authorization independence and supports secure list operations by leveraging path-based ownership for user-specific data and dedicated collections for shared resources. User data such as Persons, Income and PurchaseInstallments will be stored under the `/users/{userId}` path.  Cards are global. This approach allows us to secure `list` operations by scoping them to the authenticated user's data. Authorization Independence is achieved, because only path-based ownership is used, without denormalization or membership maps.\n\nSegregation of concerns is applied by storing `cards` outside the `users` collection since it is shared among all users.\n\nThis design is simple and scalable and debuggable as it relies on path based rules."
  }
}