{
  "entities": {
    "Person": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Person",
      "type": "object",
      "description": "Represents a person to whom purchases can be assigned.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Person entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the person."
        },
        "email": {
          "type": "string",
          "description": "The email address of the person.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Card": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Card",
      "type": "object",
      "description": "Represents a credit card.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Card entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the card (e.g., Visa, Mastercard)."
        },
        "color": {
          "type": "string",
          "description": "The color associated with the card (e.g., #3366BB)."
        }
      },
      "required": [
        "id",
        "name",
        "color"
      ]
    },
    "PurchaseInstallment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PurchaseInstallment",
      "type": "object",
      "description": "Represents an installment of a purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PurchaseInstallment entity."
        },
        "cardId": {
          "type": "string",
          "description": "Reference to Card. (Relationship: Card 1:N PurchaseInstallment)"
        },
        "personId": {
          "type": "string",
          "description": "Reference to Person. (Relationship: Person 1:N PurchaseInstallment)"
        },
        "installmentAmount": {
          "type": "number",
          "description": "The amount of each installment."
        },
        "paidInstallments": {
          "type": "number",
          "description": "The number of installments that have been paid."
        },
        "totalInstallments": {
          "type": "number",
          "description": "The total number of installments."
        },
        "paymentDeadline": {
          "type": "string",
          "description": "The deadline for the payment of the installment.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the installment purchase"
        }
      },
      "required": [
        "id",
        "cardId",
        "personId",
        "installmentAmount",
        "paidInstallments",
        "totalInstallments",
        "paymentDeadline"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "cardId": {
          "type": "string",
          "description": "Reference to Card. (Relationship: Card 1:N Expense)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "The date of the expense.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the expense"
        }
      },
      "required": [
        "id",
        "cardId",
        "amount",
        "date"
      ]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a monthly income entry for budget planning.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Income entity."
        },
        "amount": {
          "type": "number",
          "description": "The amount of monthly income."
        },
        "date": {
          "type": "string",
          "description": "The date when the income was received.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the income"
        }
      },
      "required": [
        "id",
        "amount",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/people/{personId}",
        "definition": {
          "entityName": "Person",
          "schema": {
            "$ref": "#/backend/entities/Person"
          },
          "description": "Stores person data for a specific user. User ID is used for path-based ownership, ensuring only the user can access their person data.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "personId",
              "description": "The ID of the person."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cards/{cardId}",
        "definition": {
          "entityName": "Card",
          "schema": {
            "$ref": "#/backend/entities/Card"
          },
          "description": "Stores card data for a specific user. User ID is used for path-based ownership, ensuring only the user can access their card data.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "cardId",
              "description": "The ID of the card."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/purchaseInstallments/{purchaseInstallmentId}",
        "definition": {
          "entityName": "PurchaseInstallment",
          "schema": {
            "$ref": "#/backend/entities/PurchaseInstallment"
          },
          "description": "Stores purchase installment data for a specific user. User ID is used for path-based ownership, ensuring only the user can access their purchase installment data.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "purchaseInstallmentId",
              "description": "The ID of the purchase installment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense data for a specific user. User ID is used for path-based ownership, ensuring only the user can access their expense data.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "expenseId",
              "description": "The ID of the expense."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income data for a specific user. User ID is used for path-based ownership, ensuring only the user can access their income data.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "incomeId",
              "description": "The ID of the income."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability, adhering to the principles of DBAC (Database-Based Access Control) and QAPs (Rules are not Filters).  The structure leverages path-based ownership for user-specific data and a membership map approach for collaborative data. The structure supports the core features of the CuotaControl app, enabling efficient data retrieval and management for its various functionalities, including Person and Card Management, Purchase Grouping, Expense Tracking, and Budget Planning. The design allows for straightforward security rules, enhancing the overall security and maintainability of the application. The error reported, `FirebaseError: Firebase: Error (auth/operation-not-allowed)`, suggests an issue with Firebase Authentication configuration or rules. Given only 'password' and 'anonymous' are enabled, ensure email/password sign-in is enabled in the Firebase Console. If the error persists after verifying Authentication settings, further investigation of security rules or client-side code will be needed. Ensure no operations are performed client-side that requires elevated privileges without proper authorization."
  }
}