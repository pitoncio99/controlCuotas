{
  "entities": {
    "Person": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Person",
      "type": "object",
      "description": "Represents a person to whom purchases can be assigned.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Person entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the person."
        },
        "email": {
          "type": "string",
          "description": "The email address of the person.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Card": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Card",
      "type": "object",
      "description": "Represents a credit card.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Card entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the card (e.g., Visa, Mastercard)."
        },
        "color": {
          "type": "string",
          "description": "The color associated with the card (e.g., #3366BB)."
        }
      },
      "required": [
        "id",
        "name",
        "color"
      ]
    },
    "PurchaseInstallment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PurchaseInstallment",
      "type": "object",
      "description": "Represents an installment of a purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PurchaseInstallment entity."
        },
        "cardId": {
          "type": "string",
          "description": "Reference to Card. (Relationship: Card 1:N PurchaseInstallment)"
        },
        "personId": {
          "type": "string",
          "description": "Reference to Person. (Relationship: Person 1:N PurchaseInstallment)"
        },
        "installmentAmount": {
          "type": "number",
          "description": "The amount of each installment."
        },
        "paidInstallments": {
          "type": "number",
          "description": "The number of installments that have been paid."
        },
        "totalInstallments": {
          "type": "number",
          "description": "The total number of installments."
        },
        "paymentDeadline": {
          "type": "string",
          "description": "The deadline for the payment of the installment.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the installment purchase"
        }
      },
      "required": [
        "id",
        "cardId",
        "personId",
        "installmentAmount",
        "paidInstallments",
        "totalInstallments",
        "paymentDeadline"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Expense entity."
        },
        "cardId": {
          "type": "string",
          "description": "Reference to Card. (Relationship: Card 1:N Expense)"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the expense."
        },
        "date": {
          "type": "string",
          "description": "The date of the expense.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the expense"
        }
      },
      "required": [
        "id",
        "cardId",
        "amount",
        "date"
      ]
    },
    "Income": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Income",
      "type": "object",
      "description": "Represents a monthly income entry for budget planning.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Income entity."
        },
        "amount": {
          "type": "number",
          "description": "The amount of monthly income."
        },
        "date": {
          "type": "string",
          "description": "The date when the income was received.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the income"
        }
      },
      "required": [
        "id",
        "amount",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "user",
          "schema": {
            "$ref": "#/backend/entities/Person"
          },
          "description": "Root collection for user-specific data.  Currently only serves as a path anchor for data segregation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/people/{personId}",
        "definition": {
          "entityName": "Person",
          "schema": {
            "$ref": "#/backend/entities/Person"
          },
          "description": "Stores person data, with path-based ownership.  This allows list operations to be secured by restricting access to documents within a specific user's path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "personId",
              "description": "The unique identifier of the person."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cards/{cardId}",
        "definition": {
          "entityName": "Card",
          "schema": {
            "$ref": "#/backend/entities/Card"
          },
          "description": "Stores card data, with path-based ownership.  This allows list operations to be secured by restricting access to documents within a specific user's path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "cardId",
              "description": "The unique identifier of the card."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/purchaseInstallments/{purchaseInstallmentId}",
        "definition": {
          "entityName": "PurchaseInstallment",
          "schema": {
            "$ref": "#/backend/entities/PurchaseInstallment"
          },
          "description": "Stores purchase installment data, with path-based ownership. This allows list operations to be secured by restricting access to documents within a specific user's path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "purchaseInstallmentId",
              "description": "The unique identifier of the purchase installment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expense data, with path-based ownership. This allows list operations to be secured by restricting access to documents within a specific user's path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "expenseId",
              "description": "The unique identifier of the expense."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/incomes/{incomeId}",
        "definition": {
          "entityName": "Income",
          "schema": {
            "$ref": "#/backend/entities/Income"
          },
          "description": "Stores income data, with path-based ownership. This allows list operations to be secured by restricting access to documents within a specific user's path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "incomeId",
              "description": "The unique identifier of the income."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, Clarity of Intent, and support secure list operations (QAPs). It leverages denormalization to avoid hierarchical authorization dependencies, thus enabling atomic operations and simplifying security rules. Segregation is used to create homogeneous security postures within collections. Explicit state modeling and semantic naming conventions are applied for data clarity and predictability.\n\n**Authorization Independence:** The structure avoids `get()` calls in security rules by denormalizing authorization data. For example, if access to `PurchaseInstallment` documents depended on the `Person` or `Card`'s attributes, those attributes would be copied into the `PurchaseInstallment` documents. This eliminates the need to fetch parent documents during authorization, simplifying rules and improving performance.\n\n**QAPs (Rules are not Filters):** Path-based ownership (`/users/{userId}/...`) is used for private data. This allows listing operations to be secured by restricting access to documents within a specific user's path. Collaborative data, if any, would use a membership map to control access, but in this scenario, we are relying on path-based ownership.\n\n**Structure Overview:**\n*   `/users/{userId}`: Stores user-specific data (currently not in schema but allows for future expansion).\n*   `/users/{userId}/people/{personId}`: Stores people associated with a user.\n*   `/users/{userId}/cards/{cardId}`: Stores cards associated with a user.\n*   `/users/{userId}/purchaseInstallments/{purchaseInstallmentId}`: Stores purchase installments for a user, referencing cards and people.\n*   `/users/{userId}/expenses/{expenseId}`: Stores expenses for a user, referencing cards.\n*   `/users/{userId}/incomes/{incomeId}`: Stores income entries for a user."
  }
}